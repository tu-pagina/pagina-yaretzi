<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Álbum y Diario — Johan & Yaretzi</title>
<style>
/* CSS mínimo para que se vea bien */
body{font-family:sans-serif; margin:20px; background:#fef9f9;}
.panel{background:white;padding:12px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.05); margin-bottom:12px;}
.album-item img, .entry img{max-width:200px; cursor:pointer; display:block; margin-top:6px;}
</style>
</head>
<body>

<h1>Álbum & Diario — Johan & Yaretzi</h1>

<div class="panel" id="countbox">
  <div>⏳ Nos vemos en: <span id="targetDateText"></span></div>
  <div>Días <span id="d">--</span> Horas <span id="h">--</span> Minutos <span id="m">--</span> Segundos <span id="s">--</span></div>
</div>

<div class="panel">
  <h3>📖 Nuevo recuerdo</h3>
  <form id="diarioForm">
    <input id="titulo" type="text" placeholder="Título" required><br><br>
    <textarea id="texto" placeholder="Escribe el recuerdo..." required></textarea><br><br>
    <input type="file" id="foto" accept="image/*"><br><br>
    <button type="submit">Guardar</button>
  </form>
  <h4>Entradas</h4>
  <div id="entries"></div>
</div>

<div class="panel">
  <h3>📷 Álbum</h3>
  <input type="file" id="albumFiles" multiple accept="image/*"><br>
  <div id="albumGrid"></div>
</div>

<div id="lightbox" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); justify-content:center; align-items:center;">
  <img id="lightboxImg" style="max-width:95%; max-height:90%;">
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-storage.js";

// Config de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDLDexmuJnSyXeMVOunc7dYdOc1QNeqoWM",
  authDomain: "diario-de-johan-y-yaretzi.firebaseapp.com",
  databaseURL: "https://diario-de-johan-y-yaretzi-default-rtdb.firebaseio.com",
  projectId: "diario-de-johan-y-yaretzi",
  storageBucket: "diario-de-johan-y-yaretzi.appspot.com",
  messagingSenderId: "1058412042433",
  appId: "1:1058412042433:web:18dfa5c64a2ae26389dc40"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

// ----- Temporizador -----
const targetDate = new Date(2025,9,18,0,0,0);
document.getElementById('targetDateText').textContent = targetDate.toLocaleString('es-CO');
setInterval(()=>{
  let diff = targetDate - new Date();
  if(diff<0) diff=0;
  const dias=Math.floor(diff/(1000*60*60*24));
  const horas=Math.floor((diff%(1000*60*60*24))/(1000*60*60));
  const minutos=Math.floor((diff%(1000*60*60))/(1000*60));
  const segundos=Math.floor((diff%60000)/1000);
  document.getElementById('d').textContent=dias;
  document.getElementById('h').textContent=horas;
  document.getElementById('m').textContent=minutos;
  document.getElementById('s').textContent=segundos;
},1000);

// ----- Diario -----
const entriesRef = ref(db,"entries");
const entriesContainer = document.getElementById("entries");

function renderEntry(item){
  const div = document.createElement('div'); div.className='entry';
  const date = new Date(item.fecha);
  div.innerHTML = `<strong>${item.titulo}</strong> <small>${date.toLocaleString()}</small><br>${item.texto}`;
  if(item.foto){ const img=document.createElement('img'); img.src=item.foto; img.addEventListener('click',()=>openLightbox(item.foto)); div.appendChild(img);}
  entriesContainer.appendChild(div);
}

onValue(entriesRef, snapshot=>{
  entriesContainer.innerHTML='';
  snapshot.forEach(child=> renderEntry(child.val()));
});

document.getElementById('diarioForm').addEventListener('submit', async ev=>{
  ev.preventDefault();
  const titulo=document.getElementById('titulo').value.trim();
  const texto=document.getElementById('texto').value.trim();
  let fotoURL=null;
  const file=document.getElementById('foto').files[0];
  if(file){
    const storageRef = sRef(storage,'fotos/'+Date.now()+'_'+file.name);
    await uploadBytes(storageRef,file);
    fotoURL = await getDownloadURL(storageRef);
  }
  push(entriesRef,{titulo,texto,fecha:new Date().toISOString(),foto:fotoURL});
  ev.target.reset();
});

// ----- Album -----
const albumGrid = document.getElementById('albumGrid');
const albumRef = ref(db,"album");

function renderAlbumItem(item){
  const div = document.createElement('div'); div.className='album-item';
  const img=document.createElement('img'); img.src=item.src; img.addEventListener('click',()=>openLightbox(item.src)); div.appendChild(img);
  albumGrid.appendChild(div);
}

onValue(albumRef, snapshot=>{
  albumGrid.innerHTML='';
  snapshot.forEach(child=> renderAlbumItem(child.val()));
});

document.getElementById('albumFiles').addEventListener('change', async ev=>{
  const files=Array.from(ev.target.files);
  for(const file of files){
    const storageRef = sRef(storage,'album/'+Date.now()+'_'+file.name);
    await uploadBytes(storageRef,file);
    const fotoURL = await getDownloadURL(storageRef);
    push(albumRef,{src:fotoURL,fecha:new Date().toISOString()});
  }
  ev.target.value='';
});

// ----- Lightbox -----
const lightbox=document.getElementById('lightbox');
const lightboxImg=document.getElementById('lightboxImg');
function openLightbox(src){ lightboxImg.src=src; lightbox.style.display='flex'; }
lightbox.addEventListener('click',()=>lightbox.style.display='none');

</script>
</body>
</html>
