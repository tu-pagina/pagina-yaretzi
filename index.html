<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ãlbum y Diario â€” Johan & Yaretzi</title>
  <meta name="description" content="Ãlbum y diario para Johan y Yaretzi. AÃ±ade entradas y fotos desde la pÃ¡gina. Cuenta regresiva al 18 de octubre." />
  <link rel="icon" href="favicon.png" type="image/png">

  <style>
    /* -- Tu CSS existente (igual que antes) -- */
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ’• Ãlbum & Diario â€” Johan y Yaretzi</h1>
      <p>Detalle especial â€” escribe recuerdos y sube fotos desde aquÃ­.</p>
    </header>

    <nav>
      <a href="#temporizador">Cuenta regresiva</a>
      <a href="#album">Ãlbum</a>
      <a href="#diario">Diario</a>
    </nav>

    <main>
      <section>
        <!-- Album -->
        <div id="album" class="panel">
          <h3>ğŸ“· Ãlbum</h3>
          <p class="muted-txt">Sube fotos y se sincronizarÃ¡n con Yaretzi.</p>
          <div class="controls-row">
            <input id="albumFiles" type="file" accept="image/*" multiple>
          </div>
          <div class="album-grid" id="albumGrid" aria-live="polite"></div>
        </div>

        <!-- Diario -->
        <div id="diario" class="panel" style="margin-top:14px">
          <h3>ğŸ“– Nuevo recuerdo</h3>
          <form id="diarioForm">
            <div class="row">
              <input id="titulo" name="titulo" type="text" placeholder="TÃ­tulo (ej. Primer picnic)" required />
            </div>
            <div class="row">
              <textarea id="texto" name="texto" rows="4" placeholder="Escribe el recuerdo..." required></textarea>
            </div>
            <div class="row">
              <input id="foto" name="foto" type="file" accept="image/*">
            </div>
            <div style="display:flex; gap:8px;">
              <button class="btn" type="submit">Guardar entrada</button>
              <button id="clearForm" type="button" class="btn small">Limpiar formulario</button>
            </div>
          </form>

          <h4 style="margin-top:14px">Entradas</h4>
          <div id="entries" class="entries" aria-live="polite"></div>
        </div>
      </section>

      <!-- Temporizador -->
      <aside>
        <div class="countbox panel" id="countbox">
          <div class="target">â³ Nos vemos en:</div>
          <div id="targetDateText" class="muted-txt" style="margin-bottom:10px; text-align:center"></div>
          <div class="time" id="contador">
            <div class="unit"><span class="n" id="d">--</span><span class="l">DÃ­as</span></div>
            <div class="unit"><span class="n" id="h">--</span><span class="l">Horas</span></div>
            <div class="unit"><span class="n" id="m">--</span><span class="l">Minutos</span></div>
            <div class="unit"><span class="n" id="s">--</span><span class="l">Segundos</span></div>
          </div>
        </div>
      </aside>
    </main>

    <footer>
      <p>Con amor â€” Johan & Yaretzi ğŸŒ¸</p>
    </footer>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" role="dialog" aria-hidden="true"><img id="lightboxImg" src=""></div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDLDexmuJnSyXeMVOunc7dYdOc1QNeqoWM",
      authDomain: "diario-de-johan-y-yaretzi.firebaseapp.com",
      databaseURL: "https://diario-de-johan-y-yaretzi-default-rtdb.firebaseio.com",
      projectId: "diario-de-johan-y-yaretzi",
      storageBucket: "diario-de-johan-y-yaretzi.appspot.com",
      messagingSenderId: "1058412042433",
      appId: "1:1058412042433:web:18dfa5c64a2ae26389dc40"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    /* ---------- Temporizador ---------- */
    const targetDate = new Date(2025, 9, 18, 0, 0, 0);
    function startTimer() {
      document.getElementById('targetDateText').textContent =
        targetDate.toLocaleString('es-CO', { dateStyle: 'long', timeStyle: 'short' });
      setInterval(()=>{
        let diff = targetDate - new Date();
        if(diff<0) diff=0;
        const dias = Math.floor(diff/(1000*60*60*24));
        const horas = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
        const minutos = Math.floor((diff%(1000*60*60))/(1000*60));
        const segundos = Math.floor((diff%60000)/1000);
        document.getElementById('d').textContent = dias;
        document.getElementById('h').textContent = horas;
        document.getElementById('m').textContent = minutos;
        document.getElementById('s').textContent = segundos;
      },1000);
    }

    /* ---------- Diario ---------- */
    const entriesRef = ref(db, "entries");
    const entriesContainer = document.getElementById("entries");

    function renderEntry(item){
      const div = document.createElement('div');
      div.className = 'entry';
      const date = new Date(item.fecha);
      div.innerHTML = `
        <div class="meta">
          <div><strong>${item.titulo}</strong><div class="muted-txt">${date.toLocaleString('es-CO')}</div></div>
        </div>
        <div style="margin-top:8px">${item.texto}</div>
      `;
      if(item.foto){
        const img = document.createElement('img');
        img.src = item.foto;
        img.style.cursor='zoom-in';
        img.addEventListener('click',()=>openLightbox(item.foto));
        div.appendChild(img);
      }
      entriesContainer.appendChild(div);
    }

    onValue(entriesRef, snapshot=>{
      entriesContainer.innerHTML = '';
      snapshot.forEach(child=>{
        renderEntry(child.val());
      });
    });

    document.getElementById('diarioForm').addEventListener('submit', async ev=>{
      ev.preventDefault();
      const titulo = document.getElementById('titulo').value.trim();
      const texto = document.getElementById('texto').value.trim();
      const fileInput = document.getElementById('foto');
      let fotoURL = null;

      if(fileInput.files[0]){
        const file = fileInput.files[0];
        const storageRef = sRef(storage, 'fotos/'+Date.now()+'_'+file.name);
        await uploadBytes(storageRef, file);
        fotoURL = await getDownloadURL(storageRef);
      }

      push(entriesRef,{
        titulo,
        texto,
        fecha: new Date().toISOString(),
        foto: fotoURL
      });

      document.getElementById('diarioForm').reset();
    });

    /* ---------- Album ---------- */
    const albumGrid = document.getElementById('albumGrid');
    const albumRef = ref(db, "album");

    function renderAlbumItem(item){
      const node = document.createElement('div');
      node.className = 'album-item';
      const img = document.createElement('img');
      img.src = item.src;
      img.addEventListener('click',()=>openLightbox(item.src));
      node.appendChild(img);
      albumGrid.appendChild(node);
    }

    onValue(albumRef, snapshot=>{
      albumGrid.innerHTML = '';
      snapshot.forEach(child=>{
        renderAlbumItem(child.val());
      });
    });

    document.getElementById('albumFiles').addEventListener('change', async ev=>{
      const files = Array.from(ev.target.files);
      for(const file of files){
        const storageRef = sRef(storage, 'album/'+Date.now()+'_'+file.name);
        await uploadBytes(storageRef, file);
        const fotoURL = await getDownloadURL(storageRef);
        push(albumRef, { src: fotoURL, fecha: new Date().toISOString() });
      }
      ev.target.value = '';
    });

    /* ---------- Lightbox ---------- */
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    function openLightbox(src){ lightboxImg.src=src; lightbox.style.display='flex'; }
    lightbox.addEventListener('click', ()=> lightbox.style.display='none');

    /* ---------- InicializaciÃ³n ---------- */
    document.addEventListener('DOMContentLoaded',()=>{
      startTimer();
    });
  </script>
</body>
</html>

